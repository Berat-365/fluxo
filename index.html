<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fluxo</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&family=Lato:wght@400;700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    :root {
      --site-font: 'Segoe UI', sans-serif;
      --accent-color: #00bcd4;
    }
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
      font-family: var(--site-font);
    }
    body {
      background-color: #202124;
      color: #e8eaed;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      transition: background-color 0.3s, color 0.3s;
    }
    body.light {
      background-color: #fff;
      color: #000;
    }
    body.light .search-bar input,
    body.light .buttons button,
    body.light .favorite-item,
    body.light #settingsButton,
    body.light #historyButton,
    body.light #settingsPanel,
    body.light #historyPanel,
    body.light .weather-widget {
      background-color: #f1f3f4;
      color: #000;
    }
    body.light .favorite-item a { color: #000; }
    body.light .favorite-item img {
      background: rgba(0, 0, 0, 0.1);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    body.light #suggestions {
      background-color: #f1f3f4;
      color: #000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }
    body.light #suggestions li:hover {
      background-color: #e0e0e0;
    }
    body.light #suggestions li.selected {
      background-color: #d1d1d1;
    }
    .weather-widget {
      position: fixed;
      top: 20px;
      left: 20px;
      background-color: rgba(48, 49, 52, 0.9);
      color: #e8eaed;
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 14px;
      font-family: var(--site-font);
      max-width: 250px;
      z-index: 1001;
      white-space: normal;
      word-wrap: break-word;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      transition: background-color 0.2s;
    }
    body.light .weather-widget {
      background-color: rgba(241, 243, 244, 0.9);
      color: #000;
    }
    .weather-widget:hover {
      background-color: rgba(60, 64, 67, 0.9);
    }
    body.light .weather-widget:hover {
      background-color: rgba(224, 224, 224, 0.9);
    }
    .weather-widget.hidden { display: none; }
    .weather-error {
      font-size: 12px;
      color: #ff4444;
      text-align: center;
    }
    .info-bar {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(48, 49, 52, 0.9);
      color: #e8eaed;
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 12px;
      z-index: 1000;
    }
    body.light .info-bar {
      background-color: rgba(241, 243, 244, 0.9);
      color: #000;
    }
    .info-bar.hidden { display: none; }
    .url-sidebar {
      position: fixed;
      width: 200px;
      height: calc(100vh - 40px);
      background-color: rgba(48, 49, 52, 0.9);
      color: #e8eaed;
      padding: 10px;
      border-radius: 10px;
      z-index: 1000;
      display: none;
      overflow-y: auto;
    }
    .container { 
      text-align: center; 
      width: 100%; 
      max-width: 600px;
      position: relative;
      z-index: 1000;
    }
    .logo { 
      margin-bottom: 30px; 
      display: flex;
      align-items: center;
      gap: 20px;
    }
    .logo.hidden { display: none; }
    .logo img { 
      max-height: 80px;
      cursor: pointer; 
    }
    .logo .logo-name { 
      font-size: 36px;
      font-weight: bold; 
      color: #e8eaed;
    }
    body.light .logo .logo-name { color: #000; }
    .search-bar {
      width: 100%;
      max-width: 580px;
      margin-bottom: 20px;
      position: relative;
      z-index: 1002;
    }
    .search-bar input {
      width: 100%;
      padding: 14px 50px 14px 44px;
      border-radius: 24px;
      border: none;
      background-color: #303134;
      color: #e8eaed;
      font-size: 16px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      transition: transform 0.2s, box-shadow 0.2s;
      will-change: transform, box-shadow;
    }
    .search-bar input:focus {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    body.light .search-bar input {
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
    body.light .search-bar input:focus {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    .icon-left, .icon-right {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      user-select: none;
    }
    .icon-left {
      left: 12px;
    }
    .icon-right {
      right: 12px;
    }
    .icon-left img, .icon-right img {
      width: 24px;
      height: 24px;
    }
    .buttons { 
      margin-bottom: 20px;
      z-index: 1001;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .buttons button {
      background-color: #303134;
      color: #e8eaed;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
      will-change: transform, box-shadow;
    }
    .buttons button:hover {
      background-color: #3c4043;
      transform: scale(1.05);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }
    .buttons button:active {
      transform: scale(0.95);
    }
    .buttons button.accent {
      background-color: var(--accent-color);
      color: #000;
    }
    .buttons button.accent:hover {
      background-color: #00a3b4;
    }
    .favorites {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      z-index: 1000;
    }
    .favorites.hidden { display: none; }
    .favorite-item {
      position: relative;
      background-color: #3a3b3c;
      border-radius: 8px;
      padding: 12px 10px 16px;
      width: 90px;
      cursor: move;
      transition: transform 0.2s, background-color 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .favorite-item:hover {
      transform: scale(1.05);
      background-color: #5c5e60;
    }
    .favorite-item img {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.1);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .favorite-item span {
      position: absolute;
      top: 4px;
      right: 6px;
      cursor: pointer;
      color: red;
      font-weight: bold;
      font-size: 16px;
      user-select: none;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .favorite-item:hover span {
      opacity: 1;
    }
    .favorite-item a {
      text-decoration: none;
      font-weight: 600;
      font-size: 12px;
      color: #e8eaed;
      text-align: center;
      max-width: 70px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    #addFavoriteBtn {
      background-color: var(--accent-color);
      color: #000;
      border-radius: 8px;
      padding: 12px 10px 16px;
      width: 90px;
      font-weight: bold;
      cursor: pointer;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s, box-shadow 0.2s;
      will-change: transform, box-shadow;
    }
    #addFavoriteBtn:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }
    #addFavoriteBtn:active {
      transform: scale(0.95);
    }
    #settingsButton, #historyButton {
      position: fixed;
      top: 20px;
      background-color: #303134;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 16px;
      cursor: pointer;
      font-size: 16px;
      z-index: 1001;
      transition: transform 0.2s, box-shadow 0.2s;
      will-change: transform, box-shadow;
      pointer-events: auto;
    }
    #settingsButton:hover, #historyButton:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }
    #settingsButton:active, #historyButton:active {
      transform: scale(0.95);
    }
    #settingsButton {
      right: 20px;
    }
    #historyButton {
      right: 80px;
    }
    #settingsButton img, #historyButton img {
      width: 20px;
      height: 20px;
      vertical-align: middle;
    }
    #settingsPanel, #historyPanel {
      display: none;
      position: fixed;
      top: 70px;
      right: 20px;
      background-color: #303134;
      color: white;
      padding: 20px;
      border-radius: 10px;
      width: 320px;
      text-align: left;
      z-index: 1005; /* Increased z-index to ensure panels are above search bar */
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      max-height: 80vh;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #5c5e60 #303134;
    }
    #settingsPanel::-webkit-scrollbar, #historyPanel::-webkit-scrollbar {
      width: 8px;
    }
    #settingsPanel::-webkit-scrollbar-track, #historyPanel::-webkit-scrollbar-track {
      background: #303134;
      border-radius: 10px;
    }
    #settingsPanel::-webkit-scrollbar-thumb, #historyPanel::-webkit-scrollbar-thumb {
      background: #5c5e60;
      border-radius: 10px;
    }
    #settingsPanel::-webkit-scrollbar-thumb:hover, #historyPanel::-webkit-scrollbar-thumb:hover {
      background: #7a7c80;
    }
    body.light #settingsPanel, body.light #historyPanel {
      background-color: #f1f3f4;
      color: #000;
      scrollbar-color: #d1d1d1 #f1f3f4;
    }
    body.light #settingsPanel::-webkit-scrollbar-track, body.light #historyPanel::-webkit-scrollbar-track {
      background: #f1f3f4;
    }
    body.light #settingsPanel::-webkit-scrollbar-thumb, body.light #historyPanel::-webkit-scrollbar-thumb {
      background: #d1d1d1;
    }
    body.light #settingsPanel::-webkit-scrollbar-thumb:hover, body.light #historyPanel::-webkit-scrollbar-thumb:hover {
      background: #b0b0b0;
    }
    #settingsPanel h3, #historyPanel h3 {
      font-size: 18px;
      margin-bottom: 15px;
      margin-top: 20px;
      border-bottom: 2px solid #444;
      padding-bottom: 8px;
      font-weight: 600;
    }
    body.light #settingsPanel h3, body.light #historyPanel h3 {
      border-bottom: 2px solid #ccc;
    }
    #settingsPanel label, #historyPanel label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      font-size: 14px;
    }
    #settingsPanel input, #settingsPanel select, #historyPanel input, #historyPanel select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 6px;
      border: none;
      background-color: #202124;
      color: white;
      font-size: 14px;
    }
    body.light #settingsPanel input, body.light #settingsPanel select, body.light #historyPanel input, body.light #historyPanel select {
      background-color: #e0e0e0;
      color: #000;
    }
    #colorPalette {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .color-option {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border 0.2s;
    }
    .color-option:hover {
      border: 2px solid #fff;
    }
    body.light .color-option:hover {
      border: 2px solid #000;
    }
    #settingsPanel input[type="color"] {
      height: 40px;
      padding: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    #settingsPanel button, #historyPanel button {
      margin-top: 10px;
      padding: 12px;
      width: 100%;
      border: none;
      border-radius: 8px;
      background-color: var(--accent-color);
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
      will-change: transform, box-shadow;
      pointer-events: auto;
    }
    #settingsPanel button:hover, #historyPanel button:hover {
      background-color: #00a3b4;
      transform: scale(1.05);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }
    #settingsPanel button:active, #historyPanel button:active {
      transform: scale(0.95);
    }
    #recentBgList {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    #recentBgList .bg-preview {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      padding: 5px;
      border-radius: 6px;
      background-color: #202124;
      transition: background-color 0.2s;
    }
    #recentBgList .bg-preview:hover {
      background-color: #3c4043;
    }
    body.light #recentBgList .bg-preview {
      background-color: #e0e0e0;
    }
    body.light #recentBgList .bg-preview:hover {
      background-color: #d1d1d1;
    }
    #recentBgList .bg-preview img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 4px;
    }
    #recentBgList .bg-preview span {
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 200px;
    }
    #historyList {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 60vh;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #5c5e60 #303134;
    }
    #historyList::-webkit-scrollbar {
      width: 8px;
    }
    #historyList::-webkit-scrollbar-track {
      background: #303134;
      border-radius: 10px;
    }
    #historyList::-webkit-scrollbar-thumb {
      background: #5c5e60;
      border-radius: 10px;
    }
    #historyList::-webkit-scrollbar-thumb:hover {
      background: #7a7c80;
    }
    body.light #historyList {
      scrollbar-color: #d1d1d1 #f1f3f4;
    }
    body.light #historyList::-webkit-scrollbar-track {
      background: #f1f3f4;
    }
    body.light #historyList::-webkit-scrollbar-thumb {
      background: #d1d1d1;
    }
    body.light #historyList::-webkit-scrollbar-thumb:hover {
      background: #b0b0b0;
    }
    #historyList .history-item {
      padding: 10px;
      background-color: #202124;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    #historyList .history-item:hover {
      background-color: #3c4043;
    }
    body.light #historyList .history-item {
      background-color: #e0e0e0;
    }
    body.light #historyList .history-item:hover {
      background-color: #d1d1d1;
    }
    #suggestions {
      position: absolute;
      top: calc(100% + 5px);
      left: 0;
      right: 0;
      width: 100%;
      background-color: #303134;
      color: #e8eaed;
      list-style: none;
      padding: 8px 0;
      margin: 0;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      display: none;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1003;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    #suggestions[style*="block"] {
      opacity: 1;
    }
    #suggestions::-webkit-scrollbar {
      width: 8px;
    }
    #suggestions::-webkit-scrollbar-track {
      background: #303134;
      border-radius: 10px;
    }
    #suggestions::-webkit-scrollbar-thumb {
      background: #5c5e60;
      border-radius: 10px;
    }
    #suggestions::-webkit-scrollbar-thumb:hover {
      background: #7a7c80;
    }
    body.light #suggestions {
      scrollbar-color: #d1d1d1 #f1f3f4;
    }
    body.light #suggestions::-webkit-scrollbar-track {
      background: #f1f3f4;
    }
    body.light #suggestions::-webkit-scrollbar-thumb {
      background: #d1d1d1;
    }
    body.light #suggestions::-webkit-scrollbar-thumb:hover {
      background: #b0b0b0;
    }
    #suggestions li {
      padding: 12px 16px;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      display: flex;
      align-items: center;
    }
    #suggestions li:hover {
      background-color: #3c4043;
      transform: scale(1.02);
    }
    #suggestions li.selected {
      background-color: #4a4e52;
      font-weight: 500;
    }
    #suggestions li::before {
      content: "";
    }
    #addFavoriteModal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #303134;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      z-index: 10000;
      color: #e8eaed;
      width: 320px;
      text-align: center;
    }
    #addFavoriteModal label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    #addFavoriteModal input {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border-radius: 8px;
      border: none;
      background-color: #202124;
      color: white;
    }
    #addFavoriteModal button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background-color: var(--accent-color);
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      will-change: transform, box-shadow;
    }
    #addFavoriteModal button:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }
    #addFavoriteModal button:active {
      transform: scale(0.95);
    }
    #addFavoriteModal .close {
      position: absolute;
      top: 12px;
      right: 15px;
      font-size: 22px;
      cursor: pointer;
      color: #e8eaed;
    }
    @media (max-width: 600px) {
      .search-bar { 
        max-width: 90%; 
        margin: 0 auto;
      }
      #settingsPanel, #historyPanel { 
        width: 90%; 
        right: 5%;
        top: 60px;
        max-height: 70vh;
        z-index: 1005; /* Ensure panels are above search bar on small screens */
      }
      #settingsButton { 
        right: 10px;
        padding: 8px;
      }
      #historyButton { 
        right: 60px;
        padding: 8px;
      }
      .weather-widget {
        top: 10px;
        left: 10px;
        max-width: 200px;
        font-size: 12px;
      }
      .info-bar {
        bottom: 10px;
        font-size: 10px;
        padding: 8px 16px;
      }
      .logo img {
        max-height: 60px;
      }
      .logo .logo-name {
        font-size: 28px;
      }
      .favorites {
        gap: 10px;
      }
      .favorite-item {
        width: 80px;
        padding: 10px;
      }
      #addFavoriteModal {
        width: 80%;
        max-width: 300px;
      }
      .container {
        padding: 10px;
      }
    }
    @media (max-width: 400px) {
      .search-bar input {
        font-size: 14px;
        padding: 12px 40px 12px 36px;
      }
      .buttons button {
        padding: 8px 16px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="weather-widget" id="weatherWidget" onclick="window.open('https://wttr.in', '_blank')">Yükleniyor...</div>
  <div class="info-bar" id="infoBar">Fluxo 1.2 | <span id="languageDisplay">Türkçe</span></div>
  <div class="url-sidebar" id="urlSidebar"></div>
  <button id="settingsButton">
    <img id="settingsIcon" src="settings.png" alt="Ayarlar">
  </button>
  <button id="historyButton">
    <img id="historyIcon" src="history.png" alt="Geçmiş Aramalar">
  </button>
  <div id="settingsPanel">
    <button id="applySettingsBtn" class="accent" data-lang-key="apply">Uygula</button>
    <button id="clearHistoryBtn" class="accent" data-lang-key="clearHistory">Geçmişi Temizle</button>
    <h3 data-lang-key="personalization">Kişiselleştirme</h3>
    <label for="bgUrlInput" data-lang-key="bgUrl">Arka Plan URL:</label>
    <input type="text" id="bgUrlInput" placeholder="https://...">
    <div id="recentBgList" style="margin-top: 5px;"></div>
    <label for="fontSelect" data-lang-key="font">Yazı Tipi:</label>
    <select id="fontSelect">
      <option value="'Segoe UI', sans-serif">Segoe UI</option>
      <option value="'Arial', sans-serif">Arial</option>
      <option value="'Courier New', monospace">Courier New</option>
      <option value="'Georgia', serif">Georgia</option>
      <option value="'Roboto', sans-serif">Roboto</option>
      <option value="'Open Sans', sans-serif">Open Sans</option>
      <option value="'Lato', sans-serif">Lato</option>
      <option value="'Montserrat', sans-serif">Montserrat</option>
    </select>
    <label for="themeSelect" data-lang-key="theme">Renk Teması:</label>
    <select id="themeSelect">
      <option value="dark" data-lang-key="dark">Koyu</option>
      <option value="light" data-lang-key="light">Açık</option>
    </select>
    <label for="accentColor" data-lang-key="accentColor">Vurgu Rengi:</label>
    <div id="colorPalette" class="flex flex-wrap gap-2 mt-2">
      <div class="color-option" style="background-color: #00bcd4;" onclick="selectColor('#00bcd4')"></div>
      <div class="color-option" style="background-color: #ff5722;" onclick="selectColor('#ff5722')"></div>
      <div class="color-option" style="background-color: #4caf50;" onclick="selectColor('#4caf50')"></div>
      <div class="color-option" style="background-color: #9c27b0;" onclick="selectColor('#9c27b0')"></div>
      <div class="color-option" style="background-color: #ffeb3b;" onclick="selectColor('#ffeb3b')"></div>
    </div>
    <input type="color" id="accentColor" value="#00bcd4">
    <label for="languageSelect" data-lang-key="language">Dil:</label>
    <select id="languageSelect">
      <option value="tr" data-lang-key="turkish">Türkçe</option>
      <option value="en" data-lang-key="english">English</option>
      <option value="es" data-lang-key="spanish">Español</option>
    </select>
    <label for="logoDisplaySelect" data-lang-key="logoDisplay">Logo Görüntüleme:</label>
    <select id="logoDisplaySelect">
      <option value="logo" data-lang-key="logoOnly">Sadece Logo</option>
      <option value="logo-name" data-lang-key="logoAndName">Logo ve İsim</option>
      <option value="none" data-lang-key="none">Hiçbiri</option>
    </select>
    <h3 data-lang-key="system">Sistem</h3>
    <label for="searchEngineSelect" data-lang-key="searchEngine">Arama Motoru:</label>
    <select id="searchEngineSelect">
      <option value="google">Google</option>
      <option value="bing">Bing</option>
      <option value="duckduckgo">DuckDuckGo</option>
      <option value="yandex">Yandex</option>
    </select>
    <div id="searchEnginePreview" style="margin-top: 10px; text-align: center;">
      <img src="" alt="Arama Motoru Önizlemesi" style="max-height: 40px; display: none;" id="engineLogo">
    </div>
    <label for="showFavorites" data-lang-key="showFavorites">Favorileri Göster:</label>
    <select id="showFavorites">
      <option value="true" data-lang-key="yes">Evet</option>
      <option value="false" data-lang-key="no">Hayır</option>
    </select>
    <label for="maxFavorites" data-lang-key="maxFavorites">Maksimum Favori Sayısı:</label>
    <select id="maxFavorites">
      <option value="5">5</option>
      <option value="10">10</option>
    </select>
    <label for="showSuggestions" data-lang-key="showSuggestions">Arama Önerilerini Göster:</label>
    <select id="showSuggestions">
      <option value="true" data-lang-key="yes">Evet</option>
      <option value="false" data-lang-key="no">Hayır</option>
    </select>
    <label for="showWeather" data-lang-key="showWeather">Hava Durumunu Göster:</label>
    <select id="showWeather">
      <option value="true" data-lang-key="yes">Evet</option>
      <option value="false" data-lang-key="no">Hayır</option>
    </select>
    <label for="weatherLocation" data-lang-key="weatherLocation">Hava Durumu Konumu:</label>
    <input type="text" id="weatherLocation" placeholder="Şehir ismi">
    <label for="showInfoBar" data-lang-key="showInfoBar">Bilgi Barını Göster:</label>
    <select id="showInfoBar">
      <option value="true" data-lang-key="yes">Evet</option>
      <option value="false" data-lang-key="no">Hayır</option>
    </select>
    <h3 data-lang-key="shortcuts">Klavye Kısayolları</h3>
    <label for="searchShortcutInput" data-lang-key="searchShortcut">Arama Çubuğu:</label>
    <input type="text" id="searchShortcutInput" placeholder="Ör: Ctrl + /" value="Ctrl + /">
    <label for="favoriteShortcutInput" data-lang-key="favoriteShortcut">Favori Ekle:</label>
    <input type="text" id="favoriteShortcutInput" placeholder="Ör: Ctrl + Shift + F" value="Ctrl + Shift + F">
    <label for="settingsShortcutInput" data-lang-key="settingsShortcut">Ayarlar Paneli:</label>
    <input type="text" id="settingsShortcutInput" placeholder="Ör: Ctrl + Shift + S" value="Ctrl + Shift + S">
    <label for="historyShortcutInput" data-lang-key="historyShortcut">Geçmiş Paneli:</label>
    <input type="text" id="historyShortcutInput" placeholder="Ör: Ctrl + Shift + H" value="Ctrl + Shift + H">
    <label for="imagesShortcutInput" data-lang-key="imagesShortcut">Görseller Araması:</label>
    <input type="text" id="imagesShortcutInput" placeholder="Ör: Ctrl + I" value="Ctrl + I">
    <label for="shoppingShortcutInput" data-lang-key="shoppingShortcut">Alışveriş Araması:</label>
    <input type="text" id="shoppingShortcutInput" placeholder="Ör: Ctrl + S" value="Ctrl + S">
    <label for="newsShortcutInput" data-lang-key="newsShortcut">Haberler Araması:</label>
    <input type="text" id="newsShortcutInput" placeholder="Ör: Ctrl + N" value="Ctrl + N">
  </div>
  <div id="historyPanel">
    <h3 data-lang-key="searchHistory">Arama Geçmişi</h3>
    <div id="historyList"></div>
  </div>
  <div id="addFavoriteModal">
    <span class="close" onclick="document.getElementById('addFavoriteModal').style.display='none'">×</span>
    <label for="modalName" data-lang-key="favoriteName">İsim:</label>
    <input type="text" id="modalName" placeholder="Favori ismi">
    <label for="modalUrl" data-lang-key="favoriteUrl">URL:</label>
    <input type="text" id="modalUrl" placeholder="https://...">
    <button onclick="addFavoriteFromModal()" class="accent" data-lang-key="add">Ekle</button>
  </div>
  <div class="container">
    <div class="logo" id="logo">
      <a href="#" onclick="window.location.reload()">
        <img src="logo.png" alt="Fluxo Logo" id="logoImg">
        <span class="logo-name" id="logoName">Fluxo</span>
      </a>
    </div>
    <div class="search-bar" id="searchBar">
      <span class="icon-left"><img id="searchIcon" src="search.png" alt="Arama"></span>
      <input type="text" id="searchInput" placeholder="Arama yap..." autofocus>
      <span class="icon-right" id="voiceSearchBtn"><img id="voiceIcon" src="mic.png" alt="Sesli Arama"></span>
      <ul id="suggestions" role="listbox" aria-label="Arama önerileri"></ul>
    </div>
    <div class="buttons">
      <button onclick="search('web')" class="accent" data-lang-key="search">Ara</button>
      <button onclick="search('images')" data-lang-key="images">Görseller</button>
      <button onclick="search('shopping')" data-lang-key="shopping">Alışveriş</button>
      <button onclick="search('news')" data-lang-key="news">Haberler</button>
    </div>
    <div class="favorites" id="favorites">
      <div id="addFavoriteBtn" class="favorite-item accent" data-lang-key="addFavorite">+ Favori Ekle</div>
    </div>
  </div>
  <script>
    // Dil çevirileri
    const translations = {
      tr: {
        bgUrl: "Arka Plan URL:",
        font: "Yazı Tipi:",
        theme: "Renk Teması:",
        accentColor: "Vurgu Rengi:",
        language: "Dil:",
        logoDisplay: "Logo Görüntüleme:",
        system: "Sistem",
        searchEngine: "Arama Motoru:",
        showFavorites: "Favorileri Göster:",
        maxFavorites: "Maksimum Favori Sayısı:",
        showSuggestions: "Arama Önerilerini Göster:",
        showWeather: "Hava Durumunu Göster:",
        weatherLocation: "Hava Durumu Konumu:",
        showInfoBar: "Bilgi Barını Göster:",
        apply: "Uygula",
        favoriteName: "İsim:",
        favoriteUrl: "URL:",
        add: "Ekle",
        search: "Ara",
        images: "Görseller",
        shopping: "Alışveriş",
        news: "Haberler",
        addFavorite: "+ Favori Ekle",
        dark: "Koyu",
        light: "Açık",
        turkish: "Türkçe",
        english: "English",
        spanish: "Español",
        logoOnly: "Sadece Logo",
        logoAndName: "Logo ve İsim",
        none: "Hiçbiri",
        yes: "Evet",
        no: "Hayır",
        searchPlaceholder: "Arama yap...",
        favoritePlaceholder: "Favori ismi",
        urlPlaceholder: "https://...",
        weatherLocationPlaceholder: "Şehir ismi",
        languageDisplay: "Türkçe",
        maxFavoritesAlert: "Maksimum favori sayısına ulaşıldı!",
        invalidUrlAlert: "Geçerli bir URL girin (örn: https://example.com).",
        voiceSearchNotSupported: "Sesli arama tarayıcınızda desteklenmiyor. Lütfen metin araması kullanın.",
        weatherError: "Hava durumu yüklenemedi.",
        personalization: "Kişiselleştirme",
        shortcuts: "Klavye Kısayolları",
        searchShortcut: "Arama Çubuğu:",
        favoriteShortcut: "Favori Ekle:",
        settingsShortcut: "Ayarlar Paneli:",
        historyShortcut: "Geçmiş Paneli:",
        imagesShortcut: "Görseller Araması:",
        shoppingShortcut: "Alışveriş Araması:",
        newsShortcut: "Haberler Araması:",
        searchHistory: "Arama Geçmişi",
        clearHistory: "Geçmişi Temizle",
        noHistory: "Geçmiş arama yok."
      },
      en: {
        bgUrl: "Background URL:",
        font: "Font:",
        theme: "Color Theme:",
        accentColor: "Accent Color:",
        language: "Language:",
        logoDisplay: "Logo Display:",
        system: "System",
        searchEngine: "Search Engine:",
        showFavorites: "Show Favorites:",
        maxFavorites: "Maximum Favorites:",
        showSuggestions: "Show Search Suggestions:",
        showWeather: "Show Weather:",
        weatherLocation: "Weather Location:",
        showInfoBar: "Show Info Bar:",
        apply: "Apply",
        favoriteName: "Name:",
        favoriteUrl: "URL:",
        add: "Add",
        search: "Search",
        images: "Images",
        shopping: "Shopping",
        news: "News",
        addFavorite: "+ Add Favorite",
        dark: "Dark",
        light: "Light",
        turkish: "Turkish",
        english: "English",
        spanish: "Spanish",
        logoOnly: "Logo Only",
        logoAndName: "Logo and Name",
        none: "None",
        yes: "Yes",
        no: "No",
        searchPlaceholder: "Search...",
        favoritePlaceholder: "Favorite name",
        urlPlaceholder: "https://...",
        weatherLocationPlaceholder: "City name",
        languageDisplay: "English",
        maxFavoritesAlert: "Maximum number of favorites reached!",
        invalidUrlAlert: "Enter a valid URL (e.g., https://example.com).",
        voiceSearchNotSupported: "Voice search is not supported in your browser. Please use text search.",
        weatherError: "Failed to load weather.",
        personalization: "Personalization",
        shortcuts: "Keyboard Shortcuts",
        searchShortcut: "Search Bar:",
        favoriteShortcut: "Add Favorite:",
        settingsShortcut: "Settings Panel:",
        historyShortcut: "History Panel:",
        imagesShortcut: "Images Search:",
        shoppingShortcut: "Shopping Search:",
        newsShortcut: "News Search:",
        searchHistory: "Search History",
        clearHistory: "Clear History",
        noHistory: "No search history."
      },
      es: {
        bgUrl: "URL de Fondo:",
        font: "Fuente:",
        theme: "Tema de Color:",
        accentColor: "Color de Acento:",
        language: "Idioma:",
        logoDisplay: "Visualización del Logotipo:",
        system: "Sistema",
        searchEngine: "Motor de Búsqueda:",
        showFavorites: "Mostrar Favoritos:",
        maxFavorites: "Número Máximo de Favoritos:",
        showSuggestions: "Mostrar Sugerencias de Búsqueda:",
        showWeather: "Mostrar Clima:",
        weatherLocation: "Ubicación del Clima:",
        showInfoBar: "Mostrar Barra de Información:",
        apply: "Aplicar",
        favoriteName: "Nombre:",
        favoriteUrl: "URL:",
        add: "Añadir",
        search: "Buscar",
        images: "Imágenes",
        shopping: "Compras",
        news: "Noticias",
        addFavorite: "+ Añadir Favorito",
        dark: "Oscuro",
        light: "Claro",
        turkish: "Turco",
        english: "Inglés",
        spanish: "Español",
        logoOnly: "Solo Logotipo",
        logoAndName: "Logotipo y Nombre",
        none: "Ninguno",
        yes: "Sí",
        no: "No",
        searchPlaceholder: "Buscar...",
        favoritePlaceholder: "Nombre del favorito",
        urlPlaceholder: "https://...",
        weatherLocationPlaceholder: "Nombre de la ciudad",
        languageDisplay: "Español",
        maxFavoritesAlert: "¡Se alcanzó el número máximo de favoritos!",
        invalidUrlAlert: "Ingrese una URL válida (por ejemplo, https://example.com).",
        voiceSearchNotSupported: "La búsqueda por voz no es compatible con su navegador. Utilice la búsqueda de texto.",
        weatherError: "No se pudo cargar el clima.",
        personalization: "Personalización",
        shortcuts: "Atajos de Teclado",
        searchShortcut: "Barra de Búsqueda:",
        favoriteShortcut: "Añadir Favorito:",
        settingsShortcut: "Panel de Configuración:",
        historyShortcut: "Panel de Historial:",
        imagesShortcut: "Búsqueda de Imágenes:",
        shoppingShortcut: "Búsqueda de Compras:",
        newsShortcut: "Búsqueda de Noticias:",
        searchHistory: "Historial de Búsqueda",
        clearHistory: "Borrar Historial",
        noHistory: "No hay historial de búsqueda."
      }
    };

    // Dil değiştirme fonksiyonu
    function updateLanguage(lang) {
      document.documentElement.lang = lang;
      const elements = document.querySelectorAll('[data-lang-key]');
      elements.forEach(el => {
        const key = el.getAttribute('data-lang-key');
        if (translations[lang][key]) {
          if (el.tagName === 'INPUT' && el.type === 'text') {
            el.placeholder = translations[lang][key];
          } else if (el.tagName === 'OPTION') {
            el.textContent = translations[lang][key];
          } else {
            el.textContent = translations[lang][key];
          }
        }
      });
      document.getElementById('searchInput').placeholder = translations[lang].searchPlaceholder;
      document.getElementById('modalName').placeholder = translations[lang].favoritePlaceholder;
      document.getElementById('modalUrl').placeholder = translations[lang].urlPlaceholder;
      document.getElementById('weatherLocation').placeholder = translations[lang].weatherLocationPlaceholder;
      document.getElementById('languageDisplay').textContent = translations[lang].languageDisplay;
      document.getElementById('addFavoriteBtn').textContent = translations[lang].addFavorite;
    }

    // Debounce fonksiyonu
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    async function fetchWeather() {
      const widget = document.getElementById("weatherWidget");
      const location = localStorage.getItem("weatherLocation") || "";
      try {
        const resp = await fetch(`https://wttr.in/${encodeURIComponent(location)}?format=%l:+%c+%t+%w`);
        if (!resp.ok) throw new Error("Weather fetch failed");
        const txt = await resp.text();
        widget.textContent = txt;
        widget.title = txt;
      } catch {
        widget.innerHTML = `<span class="weather-error">${
          translations[localStorage.getItem("language") || "tr"].weatherError
        }</span>`;
      }
    }

    async function cacheBackgroundImage(url) {
      try {
        const response = await fetch(url);
        const blob = await response.blob();
        const reader = new FileReader();
        reader.readAsDataURL(blob);
        reader.onloadend = () => {
          localStorage.setItem(`bgCache_${url}`, reader.result);
        };
      } catch (e) {
        console.error("Arka plan önbellekleme hatası:", e);
      }
    }

    function loadCachedBackground(url) {
      const cached = localStorage.getItem(`bgCache_${url}`);
      if (cached) {
        document.body.style.backgroundImage = `url('${cached}')`;
      } else if (url) {
        document.body.style.backgroundImage = `url('${url}')`;
        cacheBackgroundImage(url);
      } else {
        document.body.style.backgroundImage = "none";
      }
    }

    async function fetchWebsiteTitle(url) {
      try {
        const response = await fetch(url, { mode: 'no-cors' });
        const text = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(text, "text/html");
        const title = doc.querySelector("title")?.textContent;
        return title && title.trim() ? title : new URL(url).hostname.split('.')[0] || "Bilinmeyen Site";
      } catch (e) {
        console.error("Başlık alınamadı:", e);
        return new URL(url).hostname.split('.')[0] || "Bilinmeyen Site";
      }
    }

    function search(type = 'web') {
      const q = document.getElementById("searchInput").value.trim();
      const suggestionsBox = document.getElementById("suggestions");
      suggestionsBox.style.display = "none";
      if (!q) return;
      const engine = localStorage.getItem("searchEngine") || "google";
      let url;
      if (engine === "yandex") {
        if (type === 'images') {
          url = `https://yandex.com/images/search?text=${encodeURIComponent(q)}`;
        } else if (type === 'news') {
          url = `https://news.yandex.com/search?text=${encodeURIComponent(q)}`;
        } else {
          url = `https://yandex.com/search/?text=${encodeURIComponent(q)}`;
        }
      } else if (engine === "bing") {
        if (type === 'images') {
          url = `https://www.bing.com/images/search?q=${encodeURIComponent(q)}`;
        } else if (type === 'shopping') {
          url = `https://www.bing.com/shop?q=${encodeURIComponent(q)}`;
        } else if (type === 'news') {
          url = `https://www.bing.com/news/search?q=${encodeURIComponent(q)}`;
        } else {
          url = `https://www.bing.com/search?q=${encodeURIComponent(q)}`;
        }
      } else if (engine === "duckduckgo") {
        if (type === 'images') {
          url = `https://duckduckgo.com/?q=${encodeURIComponent(q)}&iax=images&ia=images`;
        } else if (type === 'shopping') {
          url = `https://duckduckgo.com/?q=${encodeURIComponent(q)}&ia=products`;
        } else if (type === 'news') {
          url = `https://duckduckgo.com/?q=${encodeURIComponent(q)}&iar=news&ia=news`;
        } else {
          url = `https://duckduckgo.com/?q=${encodeURIComponent(q)}`;
        }
      } else {
        if (type === 'images') {
          url = `https://www.google.com/search?tbm=isch&q=${encodeURIComponent(q)}`;
        } else if (type === 'shopping') {
          url = `https://www.google.com/search?tbm=shop&q=${encodeURIComponent(q)}`;
        } else if (type === 'news') {
          url = `https://www.google.com/search?tbm=nws&q=${encodeURIComponent(q)}`;
        } else {
          url = `https://www.google.com/search?q=${encodeURIComponent(q)}`;
        }
      }
      let searchHistory = JSON.parse(localStorage.getItem("searchHistory") || "[]");
      if (!searchHistory.includes(q)) {
        searchHistory.unshift(q);
        localStorage.setItem("searchHistory", JSON.stringify(searchHistory));
      }
      loadSearchHistory();
      document.getElementById("searchInput").value = "";
      window.open(url, "_blank");
    }

    function saveFavorites(favs) {
      localStorage.setItem("userFavorites", JSON.stringify(favs));
    }

    function loadFavorites() {
      const cont = document.getElementById("favorites");
      cont.innerHTML = "";
      const favs = JSON.parse(localStorage.getItem("userFavorites") || "[]");
      const maxFav = parseInt(localStorage.getItem("maxFavorites") || "5");
      favs.forEach((f, i) => {
        const btn = document.createElement("div");
        btn.className = "favorite-item";
        btn.setAttribute("draggable", "true");
        btn.setAttribute("data-index", i);
        btn.innerHTML = `
          <div style="display:flex; flex-direction: column; align-items: center; gap:4px; text-align: center;">
            <img src="https://www.google.com/s2/favicons?domain=${new URL(f.url).hostname}" style="width:32px;height:32px;border-radius:6px;">
            <a href="${f.url}" target="_blank">${f.name}</a>
          </div>
          <span onclick="removeFavorite(${i})">×</span>`;
        btn.addEventListener("dragstart", handleDragStart);
        btn.addEventListener("dragover", handleDragOver);
        btn.addEventListener("drop", handleDrop);
        cont.appendChild(btn);
      });
      const addBtn = document.createElement("div");
      addBtn.id = "addFavoriteBtn";
      addBtn.className = "favorite-item accent";
      addBtn.textContent = translations[localStorage.getItem("language") || "tr"].addFavorite;
      addBtn.onclick = () => {
        document.getElementById("addFavoriteModal").style.display = "block";
        document.getElementById("modalName").focus();
      };
      cont.appendChild(addBtn);
      document.getElementById("addFavoriteBtn").style.display = favs.length >= maxFav ? "none" : "flex";
    }

    function removeFavorite(i) {
      const favs = JSON.parse(localStorage.getItem("userFavorites") || "[]");
      favs.splice(i, 1);
      saveFavorites(favs);
      loadFavorites();
    }

    let draggedIndex = null;

    function handleDragStart(e) {
      draggedIndex = e.target.getAttribute("data-index");
      e.dataTransfer.setData("text/plain", draggedIndex);
    }

    function handleDragOver(e) {
      e.preventDefault();
    }

    function handleDrop(e) {
      e.preventDefault();
      const droppedIndex = e.target.closest(".favorite-item")?.getAttribute("data-index");
      if (draggedIndex !== null && draggedIndex !== droppedIndex) {
        const favs = JSON.parse(localStorage.getItem("userFavorites") || "[]");
        const draggedFav = favs[draggedIndex];
        favs.splice(draggedIndex, 1);
        favs.splice(droppedIndex, 0, draggedFav);
        saveFavorites(favs);
        loadFavorites();
      }
      draggedIndex = null;
    }

    async function addFavoriteFromModal() {
      const name = document.getElementById("modalName").value.trim();
      const url = document.getElementById("modalUrl").value.trim();
      const lang = localStorage.getItem("language") || "tr";
      if (!url) return alert(translations[lang].invalidUrlAlert);
      try {
        new URL(url);
        const favs = JSON.parse(localStorage.getItem("userFavorites") || "[]");
        const maxFav = parseInt(localStorage.getItem("maxFavorites") || "5");
        if (favs.length >= maxFav) {
          alert(translations[lang].maxFavoritesAlert);
          return;
        }
        const finalName = name || await fetchWebsiteTitle(url);
        favs.push({ name: finalName, url });
        saveFavorites(favs);
        loadFavorites();
        document.getElementById("addFavoriteModal").style.display = "none";
        document.getElementById("modalName").value = "";
        document.getElementById("modalUrl").value = "";
      } catch {
        alert(translations[lang].invalidUrlAlert);
      }
    }

    function loadSearchHistory() {
      const historyList = document.getElementById("historyList");
      const searchHistory = JSON.parse(localStorage.getItem("searchHistory") || "[]");
      historyList.innerHTML = searchHistory.length ? "" : `<div style="padding: 10px; font-size: 14px; color: #999;">${
        translations[localStorage.getItem("language") || "tr"].noHistory
      }</div>`;
      searchHistory.forEach((query, i) => {
        const div = document.createElement("div");
        div.className = "history-item";
        div.textContent = query;
        div.onclick = () => {
          document.getElementById("searchInput").value = query;
          document.getElementById("historyPanel").style.display = "none";
          search();
        };
        historyList.appendChild(div);
      });
    }

    document.getElementById("voiceSearchBtn").onclick = () => {
      const lang = localStorage.getItem("language") || "tr";
      if (!("webkitSpeechRecognition" in window)) {
        alert(translations[lang].voiceSearchNotSupported);
        return;
      }
      const r = new webkitSpeechRecognition();
      r.lang = lang === "tr" ? "tr-TR" : lang === "en" ? "en-US" : "es-ES";
      r.interimResults = true;
      r.continuous = true;
      r.start();
      r.onresult = (e) => {
        let interimTranscript = '';
        for (let i = e.resultIndex; i < e.results.length; i++) {
          if (e.results[i].isFinal) {
            document.getElementById("searchInput").value = e.results[i][0].transcript;
            search();
            r.stop();
          } else {
            interimTranscript += e.results[i][0].transcript;
          }
        }
        document.getElementById("searchInput").value = interimTranscript;
      };
      r.onend = () => {
        r.stop();
      };
    };

    document.getElementById("settingsButton").addEventListener("click", (e) => {
      e.stopPropagation();
      const p = document.getElementById("settingsPanel");
      p.style.display = p.style.display === "block" ? "none" : "block";
      document.getElementById("historyPanel").style.display = "none";
    });

    document.getElementById("historyButton").addEventListener("click", (e) => {
      e.stopPropagation();
      const p = document.getElementById("historyPanel");
      p.style.display = p.style.display === "block" ? "none" : "block";
      document.getElementById("settingsPanel").style.display = "none";
      loadSearchHistory();
    });

    document.getElementById("clearHistoryBtn").onclick = () => {
      localStorage.setItem("searchHistory", "[]");
      loadSearchHistory();
    };

    let handleShortcuts = null;

    function bindShortcuts() {
      if (handleShortcuts) {
        document.removeEventListener("keydown", handleShortcuts);
      }

      const searchShortcut = localStorage.getItem("searchShortcut") || "Ctrl + /";
      const favoriteShortcut = localStorage.getItem("favoriteShortcut") || "Ctrl + Shift + F";
      const settingsShortcut = localStorage.getItem("settingsShortcut") || "Ctrl + Shift + S";
      const historyShortcut = localStorage.getItem("historyShortcut") || "Ctrl + Shift + H";
      const imagesShortcut = localStorage.getItem("imagesShortcut") || "Ctrl + I";
      const shoppingShortcut = localStorage.getItem("shoppingShortcut") || "Ctrl + S";
      const newsShortcut = localStorage.getItem("newsShortcut") || "Ctrl + N";

      handleShortcuts = (e) => {
        const keyCombo = `${e.ctrlKey ? 'Ctrl + ' : ''}${e.shiftKey ? 'Shift + ' : ''}${e.key}`;
        if (keyCombo === searchShortcut) {
          e.preventDefault();
          document.getElementById("searchInput").focus();
        } else if (keyCombo === favoriteShortcut) {
          e.preventDefault();
          document.getElementById("addFavoriteModal").style.display = "block";
          document.getElementById("modalName").focus();
        } else if (keyCombo === settingsShortcut) {
          e.preventDefault();
          const p = document.getElementById("settingsPanel");
          p.style.display = p.style.display === "block" ? "none" : "block";
          document.getElementById("historyPanel").style.display = "none";
        } else if (keyCombo === historyShortcut) {
          e.preventDefault();
          const p = document.getElementById("historyPanel");
          p.style.display = p.style.display === "block" ? "none" : "block";
          document.getElementById("settingsPanel").style.display = "none";
          loadSearchHistory();
        } else if (keyCombo === imagesShortcut && document.getElementById("searchInput").value.trim()) {
          e.preventDefault();
          search('images');
        } else if (keyCombo === shoppingShortcut && document.getElementById("searchInput").value.trim()) {
          e.preventDefault();
          search('shopping');
        } else if (keyCombo === newsShortcut && document.getElementById("searchInput").value.trim()) {
          e.preventDefault();
          search('news');
        }
      };

      document.addEventListener("keydown", handleShortcuts);
    }

    function selectColor(color) {
      document.getElementById("accentColor").value = color;
      document.documentElement.style.setProperty('--accent-color', color);
      localStorage.setItem("accentColor", color);
    }

    function updateSearchEnginePreview() {
      const engine = document.getElementById("searchEngineSelect").value;
      const preview = document.getElementById("engineLogo");
      const logos = {
        google: "https://www.google.com/favicon.ico",
        bing: "https://www.bing.com/favicon.ico",
        duckduckgo: "https://duckduckgo.com/favicon.ico",
        yandex: "https://yandex.com/favicon.ico"
      };
      preview.src = logos[engine] || "";
      preview.style.display = logos[engine] ? "block" : "none";
    }

    document.getElementById("applySettingsBtn").onclick = () => {
      const bg = document.getElementById("bgUrlInput").value.trim();
      const f = document.getElementById("fontSelect").value;
      const t = document.getElementById("themeSelect").value;
      const c = document.getElementById("accentColor").value;
      const l = document.getElementById("languageSelect").value;
      const se = document.getElementById("searchEngineSelect").value;
      const sf = document.getElementById("showFavorites").value;
      const ss = document.getElementById("showSuggestions").value;
      const sw = document.getElementById("showWeather").value;
      const si = document.getElementById("showInfoBar").value;
      const ld = document.getElementById("logoDisplaySelect").value;
      const maxFav = document.getElementById("maxFavorites").value;
      const searchShortcut = document.getElementById("searchShortcutInput").value.trim();
      const favoriteShortcut = document.getElementById("favoriteShortcutInput").value.trim();
      const settingsShortcut = document.getElementById("settingsShortcutInput").value.trim();
      const historyShortcut = document.getElementById("historyShortcutInput").value.trim();
      const imagesShortcut = document.getElementById("imagesShortcutInput").value.trim();
      const shoppingShortcut = document.getElementById("shoppingShortcutInput").value.trim();
      const newsShortcut = document.getElementById("newsShortcutInput").value.trim();
      const weatherLocation = document.getElementById("weatherLocation").value.trim();
      loadCachedBackground(bg);
      document.documentElement.style.setProperty('--site-font', f);
      document.documentElement.style.setProperty('--accent-color', c);
      document.body.classList.remove("light", "dark");
      document.body.classList.add(t);
      const logoImg = document.getElementById("logoImg");
      const logoName = document.getElementById("logoName");
      const searchIcon = document.getElementById("searchIcon");
      const voiceIcon = document.getElementById("voiceIcon");
      const settingsIcon = document.getElementById("settingsIcon");
      const historyIcon = document.getElementById("historyIcon");
      logoImg.src = t === "light" ? "logo-dark.png" : "logo.png";
      searchIcon.src = t === "light" ? "search-dark.png" : "search.png";
      voiceIcon.src = t === "light" ? "mic-dark.png" : "mic.png";
      settingsIcon.src = t === "light" ? "settings-dark.png" : "settings.png";
      historyIcon.src = t === "light" ? "history-dark.png" : "history.png";
      document.getElementById("favorites").classList.toggle("hidden", sf === "false");
      document.getElementById("weatherWidget").classList.toggle("hidden", sw === "false");
      document.getElementById("logo").classList.toggle("hidden", ld === "none");
      if (ld === "logo-name") {
        logoName.style.display = "inline";
      } else if (ld === "logo") {
        logoName.style.display = "none";
      } else {
        logoName.style.display = "none";
      }
      document.getElementById("infoBar").classList.toggle("hidden", si === "false");
      let bgHistory = JSON.parse(localStorage.getItem("bgHistory") || "[]");
      if (bg && !bgHistory.includes(bg)) {
        bgHistory.unshift(bg);
        bgHistory = bgHistory.slice(0, 3);
        localStorage.setItem("bgHistory", JSON.stringify(bgHistory));
      }
      const recentBgList = document.getElementById("recentBgList");
      recentBgList.innerHTML = bgHistory.map(bg => `
        <div class="bg-preview" onclick="document.getElementById('bgUrlInput').value='${bg}';document.getElementById('applySettingsBtn').click()">
          <img src="${localStorage.getItem(`bgCache_${bg}`) || bg}" alt="Preview">
          <span>${bg}</span>
        </div>
      `).join('');
      localStorage.setItem("bgUrl", bg);
      localStorage.setItem("font", f);
      localStorage.setItem("theme", t);
      localStorage.setItem("accentColor", c);
      localStorage.setItem("language", l);
      localStorage.setItem("searchEngine", se);
      localStorage.setItem("showFavorites", sf);
      localStorage.setItem("showSuggestions", ss);
      localStorage.setItem("showWeather", sw);
      localStorage.setItem("showInfoBar", si);
      localStorage.setItem("logoDisplay", ld);
      localStorage.setItem("maxFavorites", maxFav);
      localStorage.setItem("searchShortcut", searchShortcut);
      localStorage.setItem("favoriteShortcut", favoriteShortcut);
      localStorage.setItem("settingsShortcut", settingsShortcut);
      localStorage.setItem("historyShortcut", historyShortcut);
      localStorage.setItem("imagesShortcut", imagesShortcut);
      localStorage.setItem("shoppingShortcut", shoppingShortcut);
      localStorage.setItem("newsShortcut", newsShortcut);
      localStorage.setItem("weatherLocation", weatherLocation);
      localStorage.removeItem("notes");
      updateLanguage(l);
      loadFavorites();
      updateSearchEnginePreview();
      fetchWeather();
      bindShortcuts();
    };

    window.onload = () => {
      fetchWeather();
      const bg = localStorage.getItem("bgUrl") || "";
      const f = localStorage.getItem("font") || "'Segoe UI', sans-serif";
      const t = localStorage.getItem("theme") || "dark";
      const c = localStorage.getItem("accentColor") || "#00bcd4";
      const l = localStorage.getItem("language") || "tr";
      const se = localStorage.getItem("searchEngine") || "google";
      const sf = localStorage.getItem("showFavorites") || "true";
      const ss = localStorage.getItem("showSuggestions") || "true";
      const sw = localStorage.getItem("showWeather") || "true";
      const si = localStorage.getItem("showInfoBar") || "true";
      const ld = localStorage.getItem("logoDisplay") || "logo-name";
      const maxFav = localStorage.getItem("maxFavorites") || "5";
      const searchShortcut = localStorage.getItem("searchShortcut") || "Ctrl + /";
      const favoriteShortcut = localStorage.getItem("favoriteShortcut") || "Ctrl + Shift + F";
      const settingsShortcut = localStorage.getItem("settingsShortcut") || "Ctrl + Shift + S";
      const historyShortcut = localStorage.getItem("historyShortcut") || "Ctrl + Shift + H";
      const imagesShortcut = localStorage.getItem("imagesShortcut") || "Ctrl + I";
      const shoppingShortcut = localStorage.getItem("shoppingShortcut") || "Ctrl + S";
      const newsShortcut = localStorage.getItem("newsShortcut") || "Ctrl + N";
      const weatherLocation = localStorage.getItem("weatherLocation") || "";
      document.getElementById("bgUrlInput").value = bg;
      document.getElementById("fontSelect").value = f;
      document.getElementById("themeSelect").value = t;
      document.getElementById("accentColor").value = c;
      document.getElementById("languageSelect").value = l;
      document.getElementById("searchEngineSelect").value = se;
      document.getElementById("showFavorites").value = sf;
      document.getElementById("showSuggestions").value = ss;
      document.getElementById("showWeather").value = sw;
      document.getElementById("showInfoBar").value = si;
      document.getElementById("logoDisplaySelect").value = ld;
      document.getElementById("maxFavorites").value = maxFav;
      document.getElementById("searchShortcutInput").value = searchShortcut;
      document.getElementById("favoriteShortcutInput").value = favoriteShortcut;
      document.getElementById("settingsShortcutInput").value = settingsShortcut;
      document.getElementById("historyShortcutInput").value = historyShortcut;
      document.getElementById("imagesShortcutInput").value = imagesShortcut;
      document.getElementById("shoppingShortcutInput").value = shoppingShortcut;
      document.getElementById("newsShortcutInput").value = newsShortcut;
      document.getElementById("weatherLocation").value = weatherLocation;
      document.getElementById("applySettingsBtn").click();
      loadFavorites();
      loadSearchHistory();
      bindShortcuts();
    };

    const searchInput = document.getElementById("searchInput");
    const suggestionsBox = document.getElementById("suggestions");
    let selectedIndex = -1;

    function handleSuggestions(data) {
      if (!data || !data[1] || localStorage.getItem("showSuggestions") === "false") {
        suggestionsBox.style.display = "none";
        return;
      }
      const suggestions = data[1].slice(0, 5);
      suggestionsBox.innerHTML = "";
      suggestions.forEach((s, i) => {
        const li = document.createElement("li");
        li.textContent = s;
        li.className = i === selectedIndex ? "selected" : "";
        li.setAttribute("aria-selected", i === selectedIndex ? "true" : "false");
        li.addEventListener("click", () => {
          searchInput.value = s;
          suggestionsBox.style.display = "none";
          selectedIndex = -1;
          search();
        });
        li.addEventListener("touchstart", () => {
          searchInput.value = s;
          suggestionsBox.style.display = "none";
          selectedIndex = -1;
          search();
        });
        suggestionsBox.appendChild(li);
      });
      suggestionsBox.style.display = suggestions.length ? "block" : "none";
    }

    searchInput.addEventListener("input", debounce(() => {
      const q = searchInput.value.trim();
      selectedIndex = -1;
      if (!q || q.length < 3 || localStorage.getItem("showSuggestions") === "false") {
        suggestionsBox.style.display = "none";
        return;
      }
      const oldScript = document.getElementById("jsonpScript");
      if (oldScript) oldScript.remove();
      const script = document.createElement("script");
      script.id = "jsonpScript";
      script.src = `https://suggestqueries.google.com/complete/search?client=firefox&callback=handleSuggestions&q=${encodeURIComponent(q)}`;
      document.body.appendChild(script);
    }, 500));

    searchInput.addEventListener("keydown", (e) => {
      const suggestions = suggestionsBox.querySelectorAll("li");
      if (e.key === "Enter") {
        if (selectedIndex >= 0 && suggestions[selectedIndex]) {
          searchInput.value = suggestions[selectedIndex].textContent;
          suggestionsBox.style.display = "none";
          selectedIndex = -1;
          search();
        } else {
          suggestionsBox.style.display = "none";
          search();
        }
      } else if (e.key === "ArrowDown") {
        e.preventDefault();
        if (selectedIndex < suggestions.length - 1) {
          selectedIndex++;
          updateSelected(suggestions);
        }
      } else if (e.key === "ArrowUp") {
        e.preventDefault();
        if (selectedIndex > 0) {
          selectedIndex--;
          updateSelected(suggestions);
        }
      }
    });

    function updateSelected(suggestions) {
      suggestions.forEach((li, i) => {
        li.className = i === selectedIndex ? "selected" : "";
        li.setAttribute("aria-selected", i === selectedIndex ? "true" : "false");
      });
    }

    document.addEventListener("click", (e) => {
      if (!suggestionsBox.contains(e.target) && e.target !== searchInput) {
        suggestionsBox.style.display = "none";
        selectedIndex = -1;
      }
      if (!document.getElementById("settingsPanel").contains(e.target) && e.target !== document.getElementById("settingsButton")) {
        document.getElementById("settingsPanel").style.display = "none";
      }
      if (!document.getElementById("historyPanel").contains(e.target) && e.target !== document.getElementById("historyButton")) {
        document.getElementById("historyPanel").style.display = "none";
      }
    });

    document.getElementById("searchEngineSelect").addEventListener("change", updateSearchEnginePreview);
  </script>
</body>
</html>
